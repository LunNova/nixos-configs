diff --git a/meson.build b/meson.build
index 172c64a7c70..05961e56926 100644
--- a/meson.build
+++ b/meson.build
@@ -1900,7 +1900,7 @@ endif
 
 dep_clang = null_dep
 if with_clc
-  llvm_libdir = dep_llvm.get_variable(cmake : 'LLVM_LIBRARY_DIR', configtool: 'libdir')
+  llvm_libdir = get_option('clang-libdir')
 
   dep_clang = cpp.find_library('clang-cpp', dirs : llvm_libdir, required : false)
 
diff --git a/meson_options.txt b/meson_options.txt
index 6f307018815..ab84eb1006c 100644
--- a/meson_options.txt
+++ b/meson_options.txt
@@ -18,6 +18,12 @@
 # OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 # SOFTWARE.
 
+option(
+  'clang-libdir',
+  type : 'string',
+  value : '',
+  description : 'Locations to search for clang libraries.'
+)
 option(
   'platforms',
   type : 'array',
diff --git a/src/gallium/targets/opencl/meson.build b/src/gallium/targets/opencl/meson.build
index db3586bd7fb..4d914206d21 100644
--- a/src/gallium/targets/opencl/meson.build
+++ b/src/gallium/targets/opencl/meson.build
@@ -39,7 +39,8 @@ if dep_llvm.version().version_compare('>=10.0.0')
   polly_isl_dep = cpp.find_library('PollyISL', dirs : llvm_libdir, required : false)
 endif
 
-dep_clang = cpp.find_library('clang-cpp', dirs : llvm_libdir, required : false)
+clang_libdir = get_option('clang-libdir')
+dep_clang = cpp.find_library('clang-cpp', dirs : clang_libdir, required : false)
 
 # meson will return clang-cpp from system dirs if it's not found in llvm_libdir
 linker_rpath_arg = '-Wl,--rpath=@0@'.format(llvm_libdir)
@@ -123,7 +124,7 @@ if with_opencl_icd
     configuration : _config,
     input : 'mesa.icd.in',
     output : 'mesa.icd',
-    install : true,
+    install : false,
     install_dir : join_paths(get_option('sysconfdir'), 'OpenCL', 'vendors'),
   )
 
diff --git a/src/gallium/targets/rusticl/meson.build b/src/gallium/targets/rusticl/meson.build
index a968dee52db..69475cf3133 100644
--- a/src/gallium/targets/rusticl/meson.build
+++ b/src/gallium/targets/rusticl/meson.build
@@ -58,7 +58,7 @@ configure_file(
   configuration : _config,
   input : 'rusticl.icd.in',
   output : 'rusticl.icd',
-  install : true,
+  install : false,
   install_dir : join_paths(get_option('sysconfdir'), 'OpenCL', 'vendors'),
 )
 
Author: David McFarland <corngood@gmail.com>
Date:   Mon Aug 6 15:52:11 2018 -0300

    [PATCH] disk_cache: include dri driver path in cache key
    
    This fixes invalid cache hits on NixOS where all shared library
    timestamps in /nix/store are zero.

diff --git a/src/util/disk_cache.c b/src/util/disk_cache.c
index 8dbe0938d11..498fe42de70 100644
--- a/src/util/disk_cache.c
+++ b/src/util/disk_cache.c
@@ -194,8 +194,10 @@ disk_cache_create(const char *gpu_name, const char *driver_id,
 
    /* Create driver id keys */
    size_t id_size = strlen(driver_id) + 1;
+   size_t key_size = strlen(DISK_CACHE_KEY) + 1;
    size_t gpu_name_size = strlen(gpu_name) + 1;
    cache->driver_keys_blob_size += id_size;
+   cache->driver_keys_blob_size += key_size;
    cache->driver_keys_blob_size += gpu_name_size;
 
    /* We sometimes store entire structs that contains a pointers in the cache,
@@ -216,6 +218,7 @@ disk_cache_create(const char *gpu_name, const char *driver_id,
    uint8_t *drv_key_blob = cache->driver_keys_blob;
    DRV_KEY_CPY(drv_key_blob, &cache_version, cv_size)
    DRV_KEY_CPY(drv_key_blob, driver_id, id_size)
+   DRV_KEY_CPY(drv_key_blob, DISK_CACHE_KEY, key_size)
    DRV_KEY_CPY(drv_key_blob, gpu_name, gpu_name_size)
    DRV_KEY_CPY(drv_key_blob, &ptr_size, ptr_size_size)
    DRV_KEY_CPY(drv_key_blob, &driver_flags, driver_flags_size)
diff --git a/src/util/meson.build b/src/util/meson.build
index cd44e49bfb4..f17115515a5 100644
--- a/src/util/meson.build
+++ b/src/util/meson.build
@@ -268,7 +268,12 @@ _libmesa_util = static_library(
   include_directories : [inc_include, inc_src, inc_mapi, inc_mesa, inc_gallium, inc_gallium_aux],
   dependencies : deps_for_libmesa_util,
   link_with: [libmesa_format, libmesa_util_sse41],
-  c_args : [c_msvc_compat_args],
+  c_args : [
+    c_msvc_compat_args,
+    '-DDISK_CACHE_KEY="@0@"'.format(
+      get_option('disk-cache-key')
+    ),
+  ],
   gnu_symbol_visibility : 'hidden',
   build_by_default : false
 )
